{
    "$id": "https://keo-connectivity.de/clseedi/definitions.schema.json",
    "type": "object",
    "definitions": {
        "protocolversion": {
            "type": "string",
            "description": "The version of the CLS.EEDI specification the creator of this message implements"
        },
        "scalednumber": {
            "description": "Representation of an arbitrary number where value = number * 10^scale.",
            "type": "object",
            "properties": {
                "number": {
                    "type": "integer",
                    "description": "number part (int64)",
                    "minimum": -9223372036854775808,
                    "maximum": 9223372036854775807
                },
                "scale": {
                    "type": "integer",
                    "description": "scale part (int16)",
                    "minimum": -32768,
                    "maximum": 32767
                }
            },
            "required": [
                "number",
                "scale"
            ]
        },
        "timestamp": {
            "type": "integer",
            "description": "Time since the UNIX epoch (01-01-1970) in seconds (int64)",
            "minimum": 0,
            "maximum": 9223372036854775807
        },
        "limit": {
            "type": "object",
            "properties": {
                "value": {
                    "type": "integer",
                    "description": "Power limit [W] (int64)",
                    "minimum": 0,
                    "maximum": 9223372036854775807
                },
                "active": {
                    "description": "Flag indicating whether the limit has been applied",
                    "type": "boolean"
                },
                "duration": {
                    "description": "Duration for which the limit is valid [s] (uint32)",
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 4294967295
                }
            },
            "required": [
                "value",
                "active"
            ]
        },
        "measurement": {
            "description": "A single measurement",
            "type": "object",
            "properties": {
                "value": {
                    "description": "The current numeric value of the measurement",
                    "$ref": "file:definitions.schema.json#/definitions/scalednumber"
                }
            },
            "required": [
                "value"
            ]
        },
        "phaseSpecifics": {
            "description": "Phase-specific values",
            "type": "object",
            "properties": {
                "a": {
                    "description": "Value on phase a",
                    "$ref": "file:definitions.schema.json#/definitions/measurement"
                },
                "b": {
                    "description": "Value on phase b",
                    "$ref": "file:definitions.schema.json#/definitions/measurement"
                },
                "c": {
                    "description": "Value on phase c",
                    "$ref": "file:definitions.schema.json#/definitions/measurement"
                }
            },
            "anyOf": [
                {
                    "required": [
                        "a"
                    ]
                },
                {
                    "required": [
                        "b"
                    ]
                },
                {
                    "required": [
                        "c"
                    ]
                }
            ]
        },
        "voltages": {
            "description": "Phase-specific AC voltage in [V]",
            "type": "object",
            "properties": {
                "a-n": {
                    "$ref": "file:definitions.schema.json#/definitions/measurement",
                    "description": "Voltage A to neutral"
                },
                "b-n": {
                    "$ref": "file:definitions.schema.json#/definitions/measurement",
                    "description": "Voltage B to neutral"
                },
                "c-n": {
                    "$ref": "file:definitions.schema.json#/definitions/measurement",
                    "description": "Voltage C to neutral"
                }
            },
            "anyOf": [
                {
                    "required": [
                        "a-n"
                    ]
                },
                {
                    "required": [
                        "b-n"
                    ]
                },
                {
                    "required": [
                        "c-n"
                    ]
                }
            ]
        },
        "failsafe": {
            "type": "integer",
            "description": "A failsafe consumption or production power value [W] (int64)",
            "minimum": 0,
            "maximum": 9223372036854775807
        },
        "incentiveTableDescriptionTier": {
            "type": "object",
            "properties": {
                "description": {
                    "type": "string",
                    "description": "Description of an incentive tier",
                    "maxLength": 128
                },
                "label": {
                    "type": "string",
                    "description": "Label of an incentive tier",
                    "maxLength": 128
                },
                "currency": {
                    "$ref": "file:definitions.schema.json#/definitions/currency",
                    "description": "Currency of the incentive table"
                },
                "tierId": {
                    "type": "integer",
                    "description": "Tier ID (uint32)",
                    "minimum": 0,
                    "maximum": 4294967295
                },
                "incentives": {
                    "type": "array",
                    "minItems": 1,
                    "items": {
                        "type": "object",
                        "properties": {
                            "incentiveId": {
                                "type": "integer",
                                "description": "Incentive ID (uint32)",
                                "minimum": 0,
                                "maximum": 4294967295
                            },
                            "incentive": {
                                "type": "string",
                                "description": "The incentive type of this incentive."
                            }
                        },
                        "required": [
                            "incentiveId",
                            "incentive"
                        ]
                    }
                }
            },
            "required": [
                "tierId",
                "incentives"
            ]
        },
        "incentiveTableSlot": {
            "type": "object",
            "properties": {
                "duration": {
                    "type": "integer",
                    "description": "Duration of the slot [s] (uint32)",
                    "minimum": 0,
                    "maximum": 4294967295
                },
                "tiers": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "properties": {
                            "tierId": {
                                "type": "integer",
                                "description": "ID of the tier (uint32)",
                                "minimum": 0,
                                "maximum": 4294967295
                            },
                            "lowerBoundaryValue": {
                                "$ref": "file:definitions.schema.json#/definitions/scalednumber",
                                "description": "Lower boundary of the tier [W]"
                            },
                            "incentives": {
                                "type": "array",
                                "items": {
                                    "type": "object",
                                    "properties": {
                                        "incentiveId": {
                                            "type": "integer",
                                            "description": "ID of the incentive (uint32)",
                                            "minimum": 0,
                                            "maximum": 4294967295
                                        },
                                        "value": {
                                            "$ref": "file:definitions.schema.json#/definitions/scalednumber"
                                        }
                                    }
                                }
                            }
                        },
                        "required": [
                            "tierId",
                            "lowerBoundaryValue",
                            "incentives"
                        ]
                    }
                }
            },
            "required": [
                "tiers"
            ]
        },
        "tariffSpecializationEnum": {
            "type": "string",
            "description": "Defines which cost the incentive table describes."
        },
        "tout": {
            "type": "object",
            "properties": {
                "toutSpecialization": {
                    "description": "Specialization of table: Consumption/Production and Price of Energy/Transmission Fee",
                    "items": {
                        "$ref": "file:definitions.schema.json#/definitions/tariffSpecializationEnum"
                    }
                },
                "tiers": {
                    "type": "array",
                    "items": {
                        "$ref": "file:definitions.schema.json#/definitions/incentiveTableDescriptionTier"
                    }
                },
                "slots": {
                    "type": "array",
                    "items": {
                        "$ref": "file:definitions.schema.json#/definitions/incentiveTableSlot"
                    },
                    "minItems": 1
                },
                "startTime": {
                    "$ref": "file:definitions.schema.json#/definitions/timestamp",
                    "description": "Start time of the first slot"
                }
            },
            "required": [
                "toutSpecialization",
                "tiers",
                "slots"
            ]
        },
        "tariffsToutConstraint": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "maxTiersPerSlot": {
                        "type": "integer",
                        "description": "The maximum number of tiers per slot. Note that the specification calls this element 'maxTiersPerTariff'",
                        "minimum": 0
                    },
                    "maxIncentivesPerTier": {
                        "type": "integer",
                        "description": "The maximum number of incentives per tier",
                        "minimum": 0
                    },
                    "maxSlots": {
                        "type": "integer",
                        "description": "The maximum number of slots",
                        "minimum": 0
                    },
                    "specializations": {
                        "type": "array",
                        "description": "The specializations, for which this constraint applies",
                        "items": {
                            "$ref": "file:definitions.schema.json#/definitions/tariffSpecializationEnum"
                        },
                        "minItems": 1
                    }
                },
                "required": [
                    "maxTiersPerSlot",
                    "maxIncentivesPerTier",
                    "maxSlots",
                    "specializations"
                ]
            }
        },
        "certificate": {
            "type": "string",
            "pattern": "^[a-f|0-9]+$",
            "description": "Certificate (X.509 in DER) as hex string"
        },
        "ski": {
            "type": "string",
            "pattern": "^[a-f0-9]{40}$",
            "description": "Subject Key Identifier (SKI)",
            "minLength": 40,
            "maxLength": 40,
            "examples": [
                "607d3342a4eeb06f33094386644991cd4b80125b"
            ]
        },
        "currency": {
            "type": "string",
            "description": "A string representing a currency as defined in ISO 4217:2015"
        },
        "demands": {
            "type": "object",
            "description": "Demand forecasts",
            "properties": {
                "power": {
                    "type": "object",
                    "description": "Power demands",
                    "properties": {
                        "active": {
                            "type": "object",
                            "description": "Active power forecast (PODF)",
                            "properties": {
                                "startTime": {
                                    "$ref": "file:definitions.schema.json#/definitions/timestamp",
                                    "description": "Time since the UNIX epoch (01-01-1970) in seconds (int64)"
                                },
                                "slots": {
                                    "type": "array",
                                    "items": {
                                        "type": "object",
                                        "properties": {
                                            "duration": {
                                                "type": "integer",
                                                "description": "Duration of the slot [s] (uint32)",
                                                "minimum": 0,
                                                "maximum": 4294967295
                                            },
                                            "pMin": {
                                                "type": "integer",
                                                "description": "Minimum value [W] (int64)",
                                                "minimum": -9223372036854775808,
                                                "maximum": 9223372036854775807
                                            },
                                            "pMax": {
                                                "type": "integer",
                                                "description": "Maximum value [W] (int64)",
                                                "minimum": -9223372036854775808,
                                                "maximum": 9223372036854775807
                                            },
                                            "pExp": {
                                                "type": "integer",
                                                "description": "Expected/average value [W] (int64)",
                                                "minimum": -9223372036854775808,
                                                "maximum": 9223372036854775807
                                            }
                                        },
                                        "required": [
                                            "pExp"
                                        ]
                                    }
                                }
                            },
                            "required": [
                                "slots"
                            ]
                        }
                    },
                    "required": [
                        "active"
                    ]
                }
            },
            "required": [
                "power"
            ]
        },
        "source": {
            "description": "The source of measurement data.",
            "type": "string"
        },
        "notify": {
            "type": "object",
            "properties": {
                "interval": {
                    "description": "Seconds between notifications (uint32)",
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 4294967295
                },
                "endTime": {
                    "description": "The timestamp indicating the end of the notification period",
                    "$ref": "file:definitions.schema.json#/definitions/timestamp"
                },
                "source": {
                    "description": "The source of measurement data",
                    "type": "array",
                    "items": {
                        "$ref": "file:definitions.schema.json#/definitions/source"
                    }
                }
            },
            "required": [
                "interval",
                "endTime",
                "source"
            ]
        },
        "envelopeLimit": {
            "type": "object",
            "properties": {
                "startTime": {
                    "$ref": "file:definitions.schema.json#/definitions/timestamp",
                    "description": "Start time of the first slot: Time since the UNIX epoch (01-01-1970) in seconds (int64)"
                },
                "slots": {
                    "type": "array",
                    "minItems": 1,
                    "items": {
                        "type": "object",
                        "properties": {
                            "pMin": {
                                "type": "integer",
                                "description": "Minimum value [W] (int64)",
                                "minimum": 0,
                                "maximum": 9223372036854775807
                            },
                            "pMax": {
                                "type": "integer",
                                "description": "Maximum value [W] (int64)",
                                "minimum": 0,
                                "maximum": 9223372036854775807
                            },
                            "duration": {
                                "description": "Duration for which the limit is valid [s] (uint32)",
                                "type": "integer",
                                "minimum": 0,
                                "maximum": 4294967295
                            }
                        },
                        "required": [
                            "pMax"
                        ]
                    }
                }
            },
            "required": [
                "startTime",
                "slots"
            ]
        },
        "envelopeFallback": {
            "type": "object",
            "properties": {
                "slots": {
                    "type": "array",
                    "minItems": 1,
                    "items": {
                        "type": "object",
                        "properties": {
                            "pMax": {
                                "type": "integer",
                                "description": "Maximum value [W] (int64)",
                                "minimum": 0,
                                "maximum": 9223372036854775807
                            },
                            "duration": {
                                "description": "Duration for which the limit is valid [s] (uint32)",
                                "type": "integer",
                                "minimum": 0,
                                "maximum": 4294967295
                            }
                        },
                        "required": [
                            "pMax"
                        ]
                    }
                }
            },
            "required": [
                "slots"
            ]
        },
        "envelopeConstraint": {
            "type": "object",
            "properties": {
                "minSlots": {
                    "type": "integer"
                },
                "maxSlots": {
                    "type": "integer"
                },
                "pValueMin": {
                    "type": "integer"
                },
                "pValueMax": {
                    "type": "integer"
                },
                "pValueStepSize": {
                    "type": "integer"
                },
                "durationStepSize": {
                    "type": "integer"
                }
            },
            "required": [
                "maxSlots",
                "pValueMin",
                "pValueMax"
            ]
        }
    }
}